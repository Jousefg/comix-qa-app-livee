<div class="comix-qna-wrapper" style="margin: 50px 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;">

  {% comment %} === SORU LİSTESİ BÖLÜMÜ === {% endcomment %}
  {% assign qna_list = product.metafields.custom_qna.latest_qna.value %}

  {% if qna_list != blank and qna_list.size > 0 %}
    <div class="qna-display-section">
      
      {% comment %} Header {% endcomment %}
      <div class="qna-header">
        <h2 class="qna-title">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="url(#qnaGradient)" stroke-width="2"/>
            <path d="M12 16v-4M12 8h.01" stroke="url(#qnaGradient)" stroke-width="2" stroke-linecap="round"/>
            <defs>
              <linearGradient id="qnaGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#667eea"/>
                <stop offset="100%" style="stop-color:#764ba2"/>
              </linearGradient>
            </defs>
          </svg>
          Soru & Cevaplar
          <span class="qna-count">{{ qna_list.size }} Soru</span>
        </h2>
        <p class="qna-subtitle">Müşterilerimizin merak ettiği sorular ve yanıtları</p>
      </div>

      {% comment %} Slider Container {% endcomment %}
      <div class="qna-slider-wrapper">
        <button class="qna-nav-btn qna-prev" onclick="comixQnaPrev()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        
        <div class="qna-slider" id="comixQnaSlider">
          {% for item in qna_list %}
            <div class="qna-card" data-index="{{ forloop.index0 }}">
              
              {% comment %} Soru Bölümü {% endcomment %}
              <div class="qna-question-section">
                <div class="qna-label">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                  </svg>
                  {{ item.customer | default: 'Ziyaretçi' }} Sordu
                </div>
                <p class="qna-question-text">"{{ item.question }}"</p>
              </div>
              
              {% comment %} Cevap Bölümü {% endcomment %}
              <div class="qna-answer-section">
                <div class="qna-answer-label">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                  </svg>
                  Yanıtımız
                </div>
                <p class="qna-answer-text">{{ item.answer }}</p>
                
                <div class="qna-footer">
                  <span class="qna-date">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    {{ item.date | date: "%d %b %Y" }}
                  </span>
                  <button class="qna-helpful" onclick="comixMarkHelpful({{ forloop.index0 }})">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                    </svg>
                    Faydalı
                  </button>
                </div>
              </div>
              
            </div>
          {% endfor %}
        </div>
        
        <button class="qna-nav-btn qna-next" onclick="comixQnaNext()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
      
      {% comment %} Indicator Dots {% endcomment %}
      {% if qna_list.size > 1 %}
        <div class="qna-indicator">
          {% for item in qna_list %}
            <div class="qna-dot {% if forloop.first %}active{% endif %}" onclick="comixScrollTo({{ forloop.index0 }})"></div>
          {% endfor %}
        </div>
      {% endif %}
      
    </div>
  {% endif %}

  {% comment %} === SORU SORMA FORMU === {% endcomment %}
  <div class="qna-form-section">
    <div class="qna-form-header">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="url(#formGradient)" stroke-width="2">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        <defs>
          <linearGradient id="formGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#667eea"/>
            <stop offset="100%" style="stop-color:#764ba2"/>
          </linearGradient>
        </defs>
      </svg>
      <div>
        <h3 class="qna-form-title">Aklınıza Takılanı Sorun</h3>
        <p class="qna-form-subtitle">Ürünle ilgili merak ettiğiniz her şeyi sorabilirsiniz</p>
      </div>
    </div>
    
    <form id="comixQnaForm">
      <input type="hidden" name="productId" value="{{ product.id }}">
      <input type="hidden" name="productTitle" value="{{ product.title }}">
      
      <div class="qna-form-group">
        <label class="qna-form-label">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
          İsminiz
        </label>
        <input 
          type="text" 
          name="customer" 
          placeholder="Adınız Soyadınız" 
          required 
          class="qna-form-input"
        >
      </div>

      <div class="qna-form-group">
        <label class="qna-form-label">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
          Sorunuz
        </label>
        <textarea 
          name="question" 
          rows="4" 
          placeholder="Ürün hakkında merak ettiğiniz soruyu buraya yazınız..." 
          required 
          class="qna-form-textarea"
        ></textarea>
      </div>

      <button type="submit" id="comixQnaBtn" class="qna-form-submit">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
        Soruyu Gönder
      </button>
    </form>
    
    <div id="comixQnaMessage" class="qna-message"></div>
  </div>

</div>

<style>
  /* === GENEL YAPILAR === */
  .comix-qna-wrapper * {
    box-sizing: border-box;
  }
  
  /* === HEADER STILLER === */
  .qna-header {
    text-align: center;
    margin-bottom: 40px;
    padding: 0 20px;
  }
  
  .qna-title {
    font-size: 32px;
    font-weight: 800;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin: 0 0 10px 0;
    display: inline-flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .qna-count {
    display: inline-block;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 700;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  }
  
  .qna-subtitle {
    color: #666;
    font-size: 15px;
    font-weight: 400;
    margin: 0;
  }
  
  /* === SLIDER CONTAINER === */
  .qna-slider-wrapper {
    position: relative;
    padding: 0 60px;
    margin-bottom: 30px;
  }
  
  .qna-slider {
    display: flex;
    gap: 24px;
    overflow-x: auto;
    scroll-behavior: smooth;
    padding: 25px 10px;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    scrollbar-color: #667eea #f0f0f0;
  }
  
  .qna-slider::-webkit-scrollbar {
    height: 8px;
  }
  
  .qna-slider::-webkit-scrollbar-track {
    background: #f0f0f0;
    border-radius: 10px;
  }
  
  .qna-slider::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
  }
  
  /* === KART TASARIMI === */
  .qna-card {
    min-width: 340px;
    max-width: 380px;
    background: white;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 8px 30px rgba(0,0,0,0.08);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    flex-shrink: 0;
    position: relative;
  }
  
  .qna-card:hover {
    transform: translateY(-12px) scale(1.02);
    box-shadow: 0 20px 50px rgba(102, 126, 234, 0.3);
  }
  
  .qna-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
  
  /* === SORU BÖLÜMÜ === */
  .qna-question-section {
    padding: 28px;
    background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
    border-bottom: 3px dashed #e0e7ff;
  }
  
  .qna-label {
    font-size: 12px;
    font-weight: 700;
    color: #667eea;
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .qna-question-text {
    font-size: 16px;
    color: #1a1a1a;
    line-height: 1.6;
    font-weight: 600;
    margin: 0;
  }
  
  /* === CEVAP BÖLÜMÜ === */
  .qna-answer-section {
    padding: 28px;
    background: white;
  }
  
  .qna-answer-label {
    font-size: 12px;
    font-weight: 700;
    color: #10b981;
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .qna-answer-text {
    font-size: 15px;
    color: #374151;
    line-height: 1.7;
    margin: 0 0 16px 0;
  }
  
  .qna-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 16px;
    border-top: 2px solid #f0f0f0;
  }
  
  .qna-date {
    font-size: 12px;
    color: #9ca3af;
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 500;
  }
  
  .qna-helpful {
    font-size: 12px;
    color: #667eea;
    cursor: pointer;
    padding: 6px 14px;
    border-radius: 15px;
    background: #f0f4ff;
    transition: all 0.3s;
    border: none;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  
  .qna-helpful:hover {
    background: #667eea;
    color: white;
    transform: scale(1.05);
  }
  
  /* === NAVIGASYON BUTONLARI === */
  .qna-nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: white;
    border: 3px solid #667eea;
    color: #667eea;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
    z-index: 10;
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  }
  
  .qna-nav-btn:hover {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    transform: translateY(-50%) scale(1.15);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
  }
  
  .qna-prev {
    left: 0;
  }
  
  .qna-next {
    right: 0;
  }
  
  /* === INDICATOR DOTS === */
  .qna-indicator {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 25px;
  }
  
  .qna-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #e0e7ff;
    cursor: pointer;
    transition: all 0.3s;
  }
  
  .qna-dot:hover {
    background: #c7d2fe;
    transform: scale(1.2);
  }
  
  .qna-dot.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    width: 30px;
    border-radius: 5px;
  }
  
  /* === FORM BÖLÜMÜ === */
  .qna-form-section {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
    border: 2px solid #e0e7ff;
    border-radius: 20px;
    padding: 35px;
    margin-top: 50px;
    box-shadow: 0 10px 40px rgba(102, 126, 234, 0.1);
  }
  
  .qna-form-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 30px;
  }
  
  .qna-form-title {
    margin: 0;
    font-size: 24px;
    font-weight: 800;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .qna-form-subtitle {
    margin: 5px 0 0 0;
    font-size: 13px;
    color: #666;
  }
  
  .qna-form-group {
    margin-bottom: 20px;
  }
  
  .qna-form-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    font-weight: 700;
    color: #333;
    margin-bottom: 8px;
  }
  
  .qna-form-input,
  .qna-form-textarea {
    width: 100%;
    padding: 14px 18px;
    border: 2px solid #e0e7ff;
    border-radius: 12px;
    font-size: 15px;
    font-family: inherit;
    transition: all 0.3s;
    background: white;
  }
  
  .qna-form-input:focus,
  .qna-form-textarea:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
  }
  
  .qna-form-textarea {
    min-height: 100px;
    resize: vertical;
  }
  
  .qna-form-submit {
    width: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 16px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 700;
    font-size: 16px;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
  }
  
  .qna-form-submit:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
  }
  
  .qna-form-submit:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
  }
  
  .qna-message {
    display: none;
    margin-top: 20px;
    padding: 16px 20px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    animation: slideIn 0.3s ease;
  }
  
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .qna-message.success {
    background: #f0fdf4;
    border: 2px solid #86efac;
    color: #166534;
  }
  
  .qna-message.error {
    background: #fef2f2;
    border: 2px solid #fca5a5;
    color: #991b1b;
  }
  
  /* === MOBİL UYUM === */
  @media (max-width: 768px) {
    .qna-slider-wrapper {
      padding: 0 15px;
    }
    
    .qna-card {
      min-width: 300px;
    }
    
    .qna-nav-btn {
      display: none;
    }
    
    .qna-title {
      font-size: 24px;
    }
    
    .qna-form-section {
      padding: 25px;
    }
  }
</style>

<script>
  // Slider Navigation Functions
  function comixQnaNext() {
    const slider = document.getElementById('comixQnaSlider');
    if (slider) {
      slider.scrollBy({ left: 370, behavior: 'smooth' });
    }
  }
  
  function comixQnaPrev() {
    const slider = document.getElementById('comixQnaSlider');
    if (slider) {
      slider.scrollBy({ left: -370, behavior: 'smooth' });
    }
  }
  
  function comixScrollTo(index) {
    const slider = document.getElementById('comixQnaSlider');
    const card = slider.querySelector(`[data-index="${index}"]`);
    if (card) {
      card.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });
    }
    updateActiveDot(index);
  }
  
  function updateActiveDot(index) {
    document.querySelectorAll('.qna-dot').forEach((dot, i) => {
      dot.classList.toggle('active', i === index);
    });
  }
  
  function comixMarkHelpful(index) {
    const btn = event.target.closest('.qna-helpful');
    if (btn) {
      btn.innerHTML = `
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
          <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
        </svg>
        Teşekkürler!
      `;
      btn.style.background = '#10b981';
      btn.style.color = 'white';
      btn.disabled = true;
      
      setTimeout(() => {
        btn.innerHTML = `
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
          </svg>
          Faydalı
        `;
        btn.style.background = '#f0f4ff';
        btn.style.color = '#667eea';
        btn.disabled = false;
      }, 2000);
    }
  }
  
  // Update active dot on scroll
  const slider = document.getElementById('comixQnaSlider');
  if (slider) {
    slider.addEventListener('scroll', () => {
      const cards = slider.querySelectorAll('.qna-card');
      const scrollLeft = slider.scrollLeft;
      const cardWidth = cards[0]?.offsetWidth || 370;
      const activeIndex = Math.round(scrollLeft / (cardWidth + 24));
      updateActiveDot(activeIndex);
    });
  }
  
  // Form Submission
  document.getElementById('comixQnaForm')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const btn = document.getElementById('comixQnaBtn');
    const msg = document.getElementById('comixQnaMessage');
    
    btn.innerHTML = `
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
      </svg>
      Gönderiliyor...
    `;
    btn.disabled = true;

    const formData = new FormData(e.target);
    
    try {
      const response = await fetch('/apps/destek', { 
        method: 'POST', 
        body: formData 
      });
      const data = await response.json();

      if (response.ok) {
        msg.className = 'qna-message success';
        msg.style.display = 'block';
        msg.innerHTML = `
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" style="display: inline; vertical-align: middle; margin-right: 8px;">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          ${data.message || 'Sorunuz başarıyla alındı! Onaylandıktan sonra yayınlanacaktır.'}
        `;
        e.target.reset();
        
        setTimeout(() => { 
          msg.style.display = 'none'; 
          btn.innerHTML = `
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
            Soruyu Gönder
          `;
          btn.disabled = false;
        }, 5000);
      } else {
        throw new Error(data.message);
      }
    } catch (err) {
      msg.className = 'qna-message error';
      msg.style.display = 'block';
      msg.innerHTML = `
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" style="display: inline; vertical-align: middle; margin-right: 8px;">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
        Bir hata oluştu. Lütfen tekrar deneyiniz.
      `;
      btn.innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
        Soruyu Gönder
      `;
      btn.disabled = false;
    }
  });
</script>

{% schema %}
{
  "name": "Comix Soru & Cevap",
  "target": "section",
  "settings": [],
  "presets": [
    {
      "name": "Soru & Cevap Bölümü"
    }
  ]
}
{% endschema %}